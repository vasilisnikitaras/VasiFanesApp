<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üì¶ Endora Warehouse Pro</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      color: #222;
      padding: 1rem;
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode {
      background: #1e1e1e;
      color: #eee;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
    input, select, button {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .controls button {
      flex: 1 1 48%;
    }
    .item {
      background: #fff;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border: 1px solid #ccc;
    }
    .dark-mode input, .dark-mode select, .dark-mode button {
      background: #2c2c2c;
      color: #eee;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <main class="container">
    <h2>üì¶ Endora Warehouse Pro</h2>

    <!-- Login/Register -->
    <div id="authSection">
      <input id="username" placeholder="Username" />
      <input id="password" type="password" placeholder="Password" />
      <input id="confirm" type="password" placeholder="Confirm Password (for register)" style="display:none;" />
      <div class="controls">
        <button onclick="showLoginFields(); login()">Login</button>
        <button onclick="showRegisterFields(); register()">Register</button>
      </div>
    </div>

    <!-- App Section -->
    <div id="appSection" style="display:none;">
      <h3>Welcome, <span id="userDisplay"></span></h3>
      <input id="itemName" placeholder="Item name" />
      <input id="itemQty" type="number" placeholder="Quantity" />
      <input id="itemPrice" type="number" placeholder="Price per unit" />
      <input id="itemBarcode" placeholder="Barcode (required)" />
      <button onclick="startScanner()">üì∑ Scan Barcode</button>
      <div id="scanner" style="display:none;">
        <video id="scannerPreview" style="width:100%; border:1px solid #ccc;"></video>
        <button onclick="stopScanner()">üõë Stop Scanner</button>
        <canvas id="inventoryChart" style="margin-top:1rem;"></canvas>
<button onclick="showChart()">üìä Show Chart</button>

      </div>
      <select id="category">
        <option>Furniture</option>
        <option>Electronics</option>
        <option>Books</option>
        <option>Office Supplies</option>
      </select>
     <select id="role">
     <option value="admin">Admin</option>
     <option value="staff">Staff</option>
     </select>

      
      <div class="controls">
        <button onclick="addItem()">Add</button>
        <button onclick="clearItems()">Clear</button>
        <button onclick="exportCSV()">Export CSV</button>
        <button onclick="toggleTheme()">üåó Theme</button>
        <button onclick="logout()">Logout</button>
      </div>
      <input id="searchInput" placeholder="üîç Search items..." />
      <div id="itemsList"></div>
    </div>
  </main>

  <script>
    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const username = document.getElementById('username');
    const password = document.getElementById('password');
    const confirm = document.getElementById('confirm');
    const userDisplay = document.getElementById('userDisplay');
    const itemName = document.getElementById('itemName');
    const itemQty = document.getElementById('itemQty');
    const itemPrice = document.getElementById('itemPrice');
    const itemBarcode = document.getElementById('itemBarcode');
    const category = document.getElementById('category');
    const searchInput = document.getElementById('searchInput');
    const itemsList = document.getElementById('itemsList');

    let currentUser = null;
    let users = JSON.parse(localStorage.getItem('users')) || {};

    window.onload = () => {
      const session = localStorage.getItem('session');
      if (session && users[session]) {
        currentUser = session;
        showApp();
      }
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
      }
    };

    function showLoginFields() {
      confirm.style.display = 'none';
    }

    function showRegisterFields() {
      confirm.style.display = 'block';
    }

    function register() {
      const user = username.value.trim();
      const pass = password.value.trim();
      const conf = confirm.value.trim();
      const role = document.getElementById('role').value;
      users[user] = { password: pass, role, items: [] };

      if (!user || !pass || !conf) return alert('Fill all fields');
      if (pass !== conf) return alert('Passwords do not match');
      if (users[user]) return alert('User already exists');
      users[user] = { password: pass, items: [] };
      localStorage.setItem('users', JSON.stringify(users));
      currentUser = user;
      localStorage.setItem('session', user);
      showApp();
    }

    function login() {
      const user = username.value.trim();
      const pass = password.value.trim();
      if (!users[user] || users[user].password !== pass) {
        return alert('‚ùå Invalid credentials');
      }
      currentUser = user;
      localStorage.setItem('session', user);
      showApp();
    }

    function logout() {
      localStorage.removeItem('session');
      currentUser = null;
      authSection.style.display = 'block';
      appSection.style.display = 'none';
      if (window.Quagga) Quagga.stop();
    }

    function showApp() {
      authSection.style.display = 'none';
      appSection.style.display = 'block';
      userDisplay.textContent = currentUser;
      renderItems();
    }

    function addItem() {
      const name = itemName.value.trim();
      const qty = parseInt(itemQty.value);
      const price = parseFloat(itemPrice.value);
      const cat = category.value;
      const barcode = itemBarcode.value.trim();
      if (!name || !qty || !price || !barcode) return alert('Fill all fields including barcode');
      users[currentUser].items.push({ name, qty, price, category: cat, barcode });
      localStorage.setItem('users', JSON.stringify(users));
      renderItems();
      itemName.value = '';
      itemQty.value = '';
      itemPrice.value = '';
      itemBarcode.value = '';
    }

    function clearItems() {
      users[currentUser].items = [];
      localStorage.setItem('users', JSON.stringify(users));
      renderItems();
    }

    function renderItems() {
      itemsList.innerHTML = '';
      const query = searchInput.value.toLowerCase();
      users[currentUser].items
        .filter(i => i.name.toLowerCase().includes(query))
        .forEach(item => {
          const div = document.createElement('div');
          div.className = 'item';
          const total = item.qty * item.price;
          div.innerHTML = `
            <strong>${item.name}</strong> (${item.qty} @ $${item.price.toFixed(2)})<br>
            Category: ${item.category}<br>
            Barcode: <code>${item.barcode || '‚Äî'}</code><br>
            Total: $${total.toFixed(2)}
          `;
          itemsList.appendChild(div);
        });
    }

    searchInput.oninput = renderItems;

    function exportCSV() {
      const rows = [['Name', 'Qty', 'Price', 'Category', 'Barcode']];
      users[currentUser].items.forEach(i =>
        rows.push([i.name, i.qty, i.price, i.category, i.barcode || ''])
      );
      const csv = rows.map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${currentUser}_warehouse.csv`;
      link.click();
    }
function showChart() {
  const ctx = document.getElementById('inventoryChart').getContext('2d');
  const labels = users[currentUser].items.map(i => i.name);
  const data = users[currentUser].items.map(i => i.qty);
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Stock Quantity',
        data,
        backgroundColor: 'rgba(54, 162, 235, 0.6)'
      }]
    }
  });
}
if (item.qty < 5) {
  div.style.border = '2px solid red';
  div.innerHTML += `<br><strong style="color:red;">‚ö†Ô∏è Low Stock</strong>`;
}
if (users[currentUser].role !== 'admin') {
  document.querySelector('[onclick="clearItems()"]').style.display = 'none';
  document.querySelector('[onclick="exportCSV()"]').style.display = 'none';
}

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : '
</script>
 </body>
</html>
